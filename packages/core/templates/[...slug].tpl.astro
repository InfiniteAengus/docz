---
import db from "../../db.json";
import Layout from "../layouts/Layout.astro";

export async function getStaticPaths() {
  return db.entries.map((entry) => {
    return {
      params: { slug: entry.route === "/" ? undefined : getRoute(entry) },
      props: { page: entry, db },
    };
  });
}

export function getRoute(entry) {
  if (entry.route === "/") return "/";
  return entry.route?.match(/(\/?)(.+)/)?.[2] || entry.slug;
}

const { config } = db;
const { page } = Astro.props;
const posts = await Astro.glob(`../../../**/*.{md,mdx}`);
const post = posts.find((post) => post.url === page.fullpath);
---

<Layout {page} {config} {post}>
  <slot />
</Layout>
